<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestión de Órdenes de Trabajo</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>Gestión de Órdenes de Trabajo</h1>

    <!-- Formulario para crear nueva orden -->
    <form id="formularioOrden">
      <label for="fecha">Fecha:</label>
      <input type="date" id="fecha" required><br>

      <label for="cliente">Cliente:</label>
      <input type="text" id="cliente" required><br>

      <label for="patente">Patente:</label>
      <input type="text" id="patente" required><br>

      <label for="camion">Camión:</label>
      <input type="text" id="camion" required><br>

      <label for="trabajo">Trabajo:</label>
      <textarea id="trabajo" rows="10" required></textarea><br>

      <label for="precio">Precio:</label>
      <input type="number" id="precio" required><br>

      <button type="submit">Crear Orden</button>
    </form>

    <hr>

    <!-- Lista de órdenes -->
    <h2>Órdenes de Trabajo</h2>
    <ul id="listaOrdenes"></ul>
  </div>

  <script>
    const apiUrl = 'https://ordenes-orpin.vercel.app';  // Cambia la URL a tu dominio en Vercel

    // Función para cargar todas las órdenes
    function cargarOrdenes() {
      fetch(`${apiUrl}/ordenes`)
        .then(response => response.json())
        .then(ordenes => {
          const listaOrdenes = document.getElementById('listaOrdenes');
          listaOrdenes.innerHTML = '';  // Limpiar la lista antes de agregar nuevas órdenes
          ordenes.forEach(orden => {
            const li = document.createElement('li');
            li.innerHTML = `
              <strong>Fecha:</strong> ${orden.fecha} <br>
              <strong>Cliente:</strong> ${orden.cliente} <br>
              <strong>Patente:</strong> ${orden.patente} <br>
              <strong>Camión:</strong> ${orden.camion} <br>
              <strong>Trabajo:</strong> ${orden.trabajo} <br>
              <strong>Precio:</strong> $${orden.precio} <br>
              <button onclick="editarOrden('${orden._id}')">Editar</button>
              <button onclick="borrarOrden('${orden._id}')">Borrar</button>
            `;
            listaOrdenes.appendChild(li);
          });
        })
        .catch(error => console.error('Error:', error));
    }

    // Función para crear una nueva orden
    document.getElementById('formularioOrden').addEventListener('submit', function(event) {
      event.preventDefault();

      const nuevaOrden = {
        fecha: document.getElementById('fecha').value,
        cliente: document.getElementById('cliente').value,
        patente: document.getElementById('patente').value,
        camion: document.getElementById('camion').value,
        trabajo: document.getElementById('trabajo').value,
        precio: document.getElementById('precio').value
      };

      fetch(`${apiUrl}/orden`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(nuevaOrden)
      })
      .then(response => response.json())
      .then(() => {
        cargarOrdenes();  // Recargar las órdenes después de crear una nueva
      })
      .catch(error => console.error('Error:', error));
    });

    // Función para borrar una orden
    function borrarOrden(id) {
      fetch(`${apiUrl}/orden/${id}`, { method: 'DELETE' })
        .then(response => response.json())
        .then(() => {
          cargarOrdenes();  // Recargar la lista de órdenes después de borrar una
        })
        .catch(error => console.error('Error:', error));
    }

    // Función para editar una orden (puedes implementar la lógica aquí)
    function editarOrden(id) {
      alert(`Editar orden con ID: ${id}`);
    }

    // Cargar las órdenes al inicio
    cargarOrdenes();
  </script>
</body>
</html>
